
Follow these steps **on your WireGuard VM**.

---

## 1. Apply Terraform (If Not Done)

First, ensure you have run:

```bash
terraform apply
```

This is required to open **port 51821** in the GCP firewall so you can access the `wg-easy` Web UI.

---

## 2. Stop the Manual WireGuard Service

Your current WireGuard service is using **port 51820**, which `wg-easy` needs.

Stop and disable it:

```bash
sudo systemctl stop wg-quick@wg0
sudo systemctl disable wg-quick@wg0
```

This frees the port so Docker can bind to it.

---

## 3. Install Docker

Install and start Docker:

```bash
sudo apt update
sudo apt install -y docker.io
sudo systemctl enable --now docker
```

Verify:

```bash
docker --version
```

---

## 4. Run `wg-easy`

Start the `wg-easy` container.

Replace:

- `<YOUR_VM_EXTERNAL_IP>` → your VM’s static external IP  
- `<STRONG_PASSWORD>` → a secure password for the web UI  

```bash
docker run -d --name wg-easy -e WG_HOST=136.116.181.25 -e PASSWORD=testzeus@12345 -e WG_DEFAULT_ADDRESS=10.100.0.x -e WG_DEFAULT_DNS=1.1.1.1 -e WG_ALLOWED_IPS="10.100.0.0/24, 10.20.0.0/16, 172.16.0.0/24" -e WG_MTU=1420 -v ~/.wg-easy:/etc/wireguard -p 51820:51820/udp -p 51821:51821/tcp --cap-add=NET_ADMIN --cap-add=SYS_MODULE --restart unless-stopped weejewel/wg-easy```

Check it's running:

```bash
docker ps
```

---

## 5. Access the Web UI

Open your browser:

```
http://<YOUR_VM_EXTERNAL_IP>:51821
```

Log in using the password you set.

---

## Why Use `wg-easy`?

### Easy Management
- Create new VPN clients (peers) with one click.
- Download configs or QR codes instantly.

### Automatic Configuration
- No more editing:
  ```
  /etc/wireguard/wg0.conf
  ```
- `wg-easy` manages everything inside the container.

---

## ⚠️ Important: IP Forwarding

Since you will later use the **app-vm hardened image**, the following is **critical**:

```bash
net.ipv4.ip_forward = 1
```

This must already be enabled on the host.

`wg-easy` depends on the **host’s IP forwarding** to route traffic to your **GKE nodes**.

Verify with:

```bash
sysctl net.ipv4.ip_forward
```

If needed:

```bash
sudo sysctl -w net.ipv4.ip_forward=1
```

And persist it in:

```bash
/etc/sysctl.conf
```

---
 
# To remove and run again 

docker rm -f wg-easy
sudo rm -rf ~/.wg-easy  # THIS CLEARING IS CRITICAL
